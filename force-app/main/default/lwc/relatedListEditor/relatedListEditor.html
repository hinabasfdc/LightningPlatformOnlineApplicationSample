<template>
  <div class="slds-var-p-bottom_medium">
    <template if:true={hasAnyDraft}>
      <div
        class="
          slds-p-horizontal_medium
          slds-m-top_small
          slds-m-bottom_x-small
          slds-grid slds-grid_align-start
        "
      >
        <lightning-button
          variant="brand"
          label="保存"
          onclick={handleClickSave}
        ></lightning-button>

        <lightning-button
          class="slds-m-left_medium"
          variant="neutral"
          label="キャンセル"
          onclick={handleClickCancel}
        ></lightning-button>
      </div>
    </template>
    <lightning-layout>
      <lightning-layout-item>
        <!-- ページ エリア-->
        <div class="" style="min-width: 200px">
          <lightning-vertical-navigation
            selected-item={selectedPageName}
            onselect={handleSelectPage}
            ondrop={onDropPageNav}
            ondragover={onDragOverPageNav}
          >
            <lightning-vertical-navigation-section label="ページ">
              <!-- 定義済みの項目をメニューアイテムとして一覧表示 -->
              <template if:true={hasPages}>
                <template for:each={pages} for:item="p">
                  <div class="nav-item-wrapper page-nav" key={p.id}>
                    <div class="sort-wrapper page-sort">
                      <lightning-button-icon
                        icon-name="utility:up"
                        size="small"
                        variant="bare"
                        alternative-text="Sort Up"
                        title="Sort Up"
                        data-sort-direction="up"
                        data-page-id={p.id}
                        data-sort-type="page"
                        onclick={handleSort}
                      ></lightning-button-icon>
                      <lightning-button-icon
                        icon-name="utility:down"
                        size="small"
                        variant="bare"
                        alternative-text="Sort down"
                        title="Sort down"
                        data-sort-direction="down"
                        data-page-id={p.id}
                        data-sort-type="page"
                        onclick={handleSort}
                      ></lightning-button-icon>
                    </div>
                    <lightning-vertical-navigation-item-badge
                      label={p.name}
                      name={p.id}
                      badge-count={p.fieldCount}
                      ondragstart={onDragStartPageNav}
                      class={p.status}
                    >
                    </lightning-vertical-navigation-item-badge>
                  </div>
                </template>
              </template>
              <template if:false={hasPages}>
                <div class="slds-p-horizontal_medium slds-p-top_small">
                  <span>ページを追加してください</span>
                </div>
              </template>
            </lightning-vertical-navigation-section>
          </lightning-vertical-navigation>
          <div class="slds-p-around_medium">
            <!-- 新規ページ追加 -->
            <lightning-button
              label="新規ページ"
              variant="brand-outline"
              onclick={handleClickNewPage}
            ></lightning-button>
          </div>
        </div>
      </lightning-layout-item>
      <lightning-layout-item flexibility="grow">
        <!-- 定義詳細項目 エリア -->
        <div class="slds-box">
          <lightning-layout multiple-rows="true">
            <template if:false={selectedPage}>
              <lightning-layout-item size="12">
                <div>ページを選択すると、項目を操作できます。</div>
              </lightning-layout-item>
            </template>
            <template if:true={selectedPage}>
              <lightning-layout-item
                size="12"
                class="slds-p-top_xx-small slds-p-bottom_medium"
              >
                <lightning-layout>
                  <lightning-layout-item>
                    <span class="slds-form-element__label slds-no-flex"
                      >ページ名</span
                    >
                  </lightning-layout-item>
                  <lightning-layout-item flexibility="grow">
                    <lightning-input
                      type="text"
                      label="ページ名"
                      variant="label-hidden"
                      value={selectedPage.name}
                      onchange={handlePageNameInputChange}
                    ></lightning-input>
                  </lightning-layout-item>
                  <lightning-layout-item class="slds-m-left_xx-large">
                    <lightning-button
                      label="ページを削除"
                      variant="destructive"
                      onclick={handleClickDeletePage}
                    ></lightning-button>
                  </lightning-layout-item>
                </lightning-layout>
              </lightning-layout-item>

              <lightning-layout-item size="12">
                <lightning-layout>
                  <lightning-layout-item>
                    <template if:true={selectedField}>
                      <!-- ナビゲーションメニューとして表示し、クリックされたら handleSelectField を呼出 -->
                      <lightning-vertical-navigation
                        selected-item={selectedFieldName}
                        onselect={handleSelectField}
                        class="field-v-nav"
                      >
                        <lightning-vertical-navigation-section>
                          <!-- 定義済みの項目をメニューアイテムとして一覧表示 -->
                          <template if:true={selectedPage}>
                            <template for:each={selectedPage.rows} for:item="r">
                              <template if:true={r}>
                                <template for:each={r.fields} for:item="f">
                                  <div
                                    class="nav-item-wrapper field-nav"
                                    key={f.id}
                                  >
                                    <div class="sort-wrapper field-sort">
                                      <lightning-button-icon
                                        icon-name="utility:up"
                                        size="small"
                                        variant="bare"
                                        alternative-text="Sort Up"
                                        title="Sort Up"
                                        data-sort-direction="up"
                                        data-id={f.id}
                                        data-sort-type="field"
                                        onclick={handleSort}
                                      ></lightning-button-icon>
                                      <lightning-button-icon
                                        icon-name="utility:down"
                                        size="small"
                                        variant="bare"
                                        alternative-text="Sort down"
                                        title="Sort down"
                                        data-sort-direction="down"
                                        data-id={f.id}
                                        data-sort-type="field"
                                        onclick={handleSort}
                                      ></lightning-button-icon>
                                    </div>
                                    <lightning-vertical-navigation-item
                                      key={f.id}
                                      label={f.displayName}
                                      name={f.id}
                                      class={f.status}
                                    ></lightning-vertical-navigation-item>
                                  </div>
                                </template>
                              </template>
                            </template>
                          </template>
                        </lightning-vertical-navigation-section>
                      </lightning-vertical-navigation>
                    </template>
                    <div class="slds-p-around_medium">
                      <!-- 新規ページ追加 -->
                      <lightning-button
                        label="新規項目"
                        variant="brand-outline"
                        onclick={handleClickNewField}
                      ></lightning-button>
                      <!--
                    <lightning-button
                      label="列を追加"
                      variant="neutral"
                      onclick={handleClickNewRow}
                    ></lightning-button>
                    --></div>
                  </lightning-layout-item>
                  <lightning-layout-item flexibility="grow">
                    <!-- 項目内容表示エリア -->
                    <div class="slds-box">
                      <lightning-record-edit-form
                        object-api-name={objectApiNameApplicationTemplateDetail}
                        onsubmit={handleSubmit}
                        onsuccess={handleSuccess}
                      >
                        <lightning-messages></lightning-messages>

                        <!-- 項目表示名 -->
                        <lightning-input-field
                          onchange={handleNewFieldInputChange}
                          data-field-name={fieldnameName}
                          value={newFieldValueName}
                          field-name={fieldnameName}
                        ></lightning-input-field>
                        <!-- 補助説明 -->
                        <lightning-input-field
                          field-name={fieldnameDescription}
                          onchange={handleNewFieldInputChange}
                          data-field-name={fieldnameDescription}
                          value={newFieldValueDescription}
                        ></lightning-input-field>
                        <!-- 項目カテゴリ -->
                        <lightning-input-field
                          field-name={fieldnameCategory}
                          onchange={handleNewFieldInputChange}
                          data-field-name={fieldnameCategory}
                          value={newFieldValueCategory}
                        ></lightning-input-field>
                        <!-- 標準項目名(項目カテゴリが標準の場合のみ) -->
                        <template if:true={isStandardColumn}>
                          <lightning-input-field
                            field-name={fieldnameStdColumnName}
                            onchange={handleNewFieldInputChange}
                            data-field-name={fieldnameStdColumnName}
                            value={newFieldValueStdColumnName}
                          ></lightning-input-field>
                        </template>
                        <!-- データ型(項目カテゴリがカスタムの場合のみ) -->
                        <template if:true={isCustomColumn}>
                          <lightning-input-field
                            field-name={fieldnameDataType}
                            onchange={handleNewFieldInputChange}
                            data-field-name={fieldnameDataType}
                            value={newFieldValueDataType}
                          ></lightning-input-field>
                          <!-- 選択肢(データ型が選択肢の場合のみ) -->
                          <template if:true={isCustomColumnPicklist}>
                            <lightning-input-field
                              field-name={fieldnameOptions}
                              onchange={handleNewFieldInputChange}
                              data-field-name={fieldnameOptions}
                              value={newFieldValueOptions}
                            ></lightning-input-field>
                          </template>
                        </template>
                        <!-- 必須かどうか -->
                        <lightning-input-field
                          field-name={fieldnameRequired}
                          onchange={handleNewFieldInputChange}
                          data-field-name={fieldnameRequired}
                          value={newFieldValueRequired}
                        ></lightning-input-field>
                        <!-- デフォルト値 -->
                        <lightning-input-field
                          field-name={fieldnameValue}
                          onchange={handleNewFieldInputChange}
                          data-field-name={fieldnameValue}
                          value={newFieldValueDefaultValue}
                        ></lightning-input-field>
                        <!-- 表示順 -->
                        <!--
                        <lightning-input-field
                          field-name={fieldnameSortOrder}
                        ></lightning-input-field>
                        -->
                      </lightning-record-edit-form>
                      <div
                        class="slds-m-top_small slds-grid slds-grid_align-end"
                      >
                        <lightning-button
                          class="slds-col"
                          label="項目削除"
                          variant="destructive"
                          onclick={handleClickDeleteField}
                        ></lightning-button>
                      </div>
                    </div>
                  </lightning-layout-item>
                </lightning-layout>
              </lightning-layout-item>
            </template>
          </lightning-layout>
        </div>
      </lightning-layout-item>
    </lightning-layout>
  </div>
</template>
